#VERSION 3.1.1d13
#VERSION 3.1.1d13
#VERSION 3.1.1d14
use bn;
alter table plans drop index group_plan_costcode_period;
alter table plans add unique Group_Plan_CostCode_StartDate_EndDate_Period (GroupId,Plan,CostCode,EffectiveStartDate,EffectiveEndDate,PeriodId);
alter table users drop index Group_Plan_CostCode_Period;
alter table users add index Group_Plan_CostCode_StartDate_EndDate_Period (GroupId,Plan,CostCode,EffectiveStartDate,EffectiveEndDate,PeriodId);
alter table sessions add GroupId tinyint(1) NOT NULL default '-1' after User;
alter table sessions drop PRIMARY KEY;
alter table sessions add PRIMARY KEY (User,GroupId);
alter table sessions drop KEY SessionId (SessionId);
alter table sessions add UNIQUE KEY SessionId (SessionId);
#VERSION 3.1.1d14
#VERSION 3.1.1d15
#VERSION 3.1.1d15
#VERSION 3.1.1d16
#VERSION 3.1.1d16
#VERSION 3.1.1t1
#VERSION 3.1.1t1
#VERSION 3.1.1c1
#VERSION 3.1.1c1
#VERSION 3.1.1c2
#VERSION 3.1.1c2
#VERSION 3.1.1c3
#VERSION 3.1.1c3
#VERSION 3.1.1c4
#VERSION 3.1.1c4
#VERSION 3.1.1c5
#VERSION 3.1.1c5
#VERSION 3.1.1c6
#VERSION 3.1.1c6
#VERSION 3.1.1c7
#VERSION 3.1.1c7
#VERSION 3.1.1c8
#VERSION 3.1.1c8
#VERSION 3.1.1c9
#VERSION 3.1.1c9
#VERSION 3.1.1c10
#VERSION 3.1.1c10
#VERSION 3.1.1c11
#VERSION 3.1.1c11
#VERSION 3.1.1c12
#VERSION 3.1.1c12
#VERSION 3.1.1c13
#VERSION 3.1.1c13
#VERSION 3.1.1c14
#VERSION 3.1.1c14
#VERSION 3.1.1c15
#VERSION 3.1.1c15
#VERSION 3.1.1c16
use bn;
delete from ivms-cdr-table using ivms-cdr-table, cdrlogs where ivms-cdr-table.datetimeint = cdrlogs.enddateint and ivms-cdr-table.cdrlogid=cdrlogs.cdrlogid;
#VERSION 3.1.1c16
#VERSION 3.1.1c17
#VERSION 3.1.1c17
#VERSION 3.1.1c18
#VERSION 3.1.1c18
#VERSION 3.1.1c19
#VERSION 3.1.1c19
#VERSION 3.1.1c20
#VERSION 3.1.1c20
#VERSION 3.1.1c21
#VERSION 3.1.1c21
use bn;
alter table services drop column Name;
alter table cdrfiles drop index SrcFileName;
#VERSION 3.2.1d1
#VERSION 3.2.1d1
#VERSION 3.2.1d2
use bn;
DROP DATABASE IF EXISTS oldbn;
create database oldbn;
rename table endpoints to oldbn.endpoints;
DROP TABLE IF EXISTS endpoints;
CREATE TABLE endpoints (
  EndpointId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  MSWId smallint(6) NOT NULL default '-1',
  flag tinyint(1) NOT NULL default '0',
  realmname varchar(31) binary NOT NULL default '',
  serialNumber varchar(67) binary NOT NULL default '',
  port int(11) NOT NULL default '0',
  extNumber varchar(63) binary NOT NULL default '',
  phone varchar(63) binary NOT NULL default '',
  firstName varchar(27) binary NOT NULL default '',
  lastName varchar(27) binary NOT NULL default '',
  location varchar(27) binary NOT NULL default '',
  country varchar(27) binary NOT NULL default '',
  comments varchar(27) binary NOT NULL default '',
  customerId varchar(27) binary NOT NULL default '',
  trunkGroup varchar(63) binary NOT NULL default '',
  zone varchar(29) binary NOT NULL default '',
  email varchar(79) binary NOT NULL default '',
  forwardedPhone varchar(63) binary NOT NULL default '',
  forwardedVpnPhone varchar(63) binary NOT NULL default '',
  callingPlanName varchar(59) binary NOT NULL default '',
  h323Id varchar(127) binary NOT NULL default '',
  sipUri blob NOT NULL,
  sipContact blob NOT NULL,
  techPrefix varchar(63) binary NOT NULL default '',
  peerGkId blob NOT NULL,
  h235Password varchar(64) binary NOT NULL default '',
  vpnName varchar(27) binary NOT NULL default '',
  ogp varchar(63) binary NOT NULL default '',
  proxyValid tinyint(4) default NULL,
  isProxied tinyint(4) default NULL,
  isProxying tinyint(4) default NULL,
  callForwarded tinyint(4) default NULL,
  isCallRollover tinyint(4) default NULL,
  devType int(11) default NULL,
  ipaddr int(11) default NULL,
  forwardedVpnExtLen int(11) default NULL,
  maxCalls int(11) default NULL,
  maxInCalls int(11) default NULL,
  maxOutCalls int(11) default NULL,
  priority int(11) default NULL,
  rasPort int(11) default NULL,
  q931Port int(11) default NULL,
  callpartyType int(11) default NULL,
  currentCalls int(11) default NULL,
  vendor int(11) default NULL,
  extLen int(11) default NULL,
  subnetip int(11) default NULL,
  subnetmask int(11) default NULL,
  maxHunts int(11) default NULL,
  extCaps int(11) default NULL,
  caps int(11) default NULL,
  stateFlags int(11) default NULL,
  layer1Protocol int(11) default NULL,
  inceptionTime bigint(20) default NULL,
  refreshTime bigint(20) default NULL,
  infotranscap int(11) default NULL,
  srcingresstg varchar(63) binary NOT NULL default '',
  igrpname varchar(31) binary NOT NULL default '',
  dtg varchar(63) binary NOT NULL default '',
  newsrcdtg varchar(63) binary NOT NULL default '',
  natip int(11) default NULL,
  natport int(11) default NULL,
  callIdBlock smallint(6) default NULL,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (EndpointId),
  UNIQUE KEY Ep_Port (serialNumber,Port),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=InnoDB PACK_KEYS=DEFAULT;

REPLACE INTO endpoints (EndpointId, GroupId, realmname, serialNumber, port, created, lastmodified) VALUES (-1,1,'','*',-1,now(),now());

#insert into endpoints (
#  EndpointId,
#  GroupId,
#  port,
#  Created,
#  LastModified
#) select
#  EndpointId,
#  GroupId,
#  Port,
#  Created,
#  LastModified
#from oldbn.endpoints;

alter table msws add ClusterId smallint(6) NOT NULL after MSWId;
alter table msws add ReadPassword varchar(16) NOT NULL default '' after MSWIp;
alter table msws add WritePassword varchar(16) NOT NULL default '' after ReadPassword;
alter table msws drop index MSWName;
alter table msws add UNIQUE MSWIp (MSWIp);

DROP TABLE IF EXISTS realms;
CREATE TABLE realms(
  RealmId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  Name varchar(31) binary NOT NULL default '',
  IfName varchar(16) binary NOT NULL default '',
  VipName varchar(16) binary NOT NULL default '',
  Id bigint(20) default NULL,
  Rsa bigint(20) default NULL,
  Mask bigint(20) default NULL,
  SigPoolId int(11) default NULL,
  MedPoolId int(11) default NULL,
  AddrType int(11) default NULL,
  AdminStatus int(11) default NULL,
  OpStatus int(11) default NULL,
  Imr smallint(6) default NULL,
  Emr smallint(6) default NULL,
  SipAuth int(11) default NULL,
  CidBlock varchar(15) binary NOT NULL default '',
  CidUnBlock varchar(15) binary NOT NULL default '',
  ProxyRegId varchar(67) binary NOT NULL default '',
  ProxyPort int(11) NOT NULL default '0',
  VnetName varchar(16) binary NOT NULL default '',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (RealmId),
  UNIQUE KEY RealmName (Name),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=MyISAM  PACK_KEYS=DEFAULT;
#VERSION 3.2.1d2
#VERSION 3.2.1d3
use bn;
alter table carrierplans add StripPrefix varchar(32) NOT NULL default '' after Description;
DROP TABLE IF EXISTS iedgegroups;
CREATE TABLE iedgegroups (
  Id bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  Name varchar(31) binary NOT NULL default '',
  MaxIn int(11) default NULL,
  MaxOut int(11) default NULL,
  MaxTotal int(11) default NULL,
  CallsIn int(11) default NULL,
  CallsOut int(11) default NULL,
  CallsTotal int(11) default NULL,
  DndTime bigint(20) default NULL,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (Id),
  UNIQUE KEY IEdgeGroupName (Name),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=MyISAM PACK_KEYS=DEFAULT;
#VERSION 3.2.1d3
#VERSION 3.2.1d4
use bn;
DROP TABLE IF EXISTS ANI;
CREATE TABLE ANI (
  ANIId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  ANI varchar(32) NOT NULL default '',
  CallNumber  varchar(32) NOT NULL default '',
  Prefix varchar(32) NOT NULL default '',
  PrefixLength mediumint(9) NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (ANIId),
  UNIQUE KEY ANI_Call_GroupId (ANI,CallNumber,GroupId),
  KEY ANI (ANI)
) TYPE=MyISAM PACK_KEYS=DEFAULT;

alter table carrierplans add ANI varchar(32) NOT NULL default '' after Description;

alter table groups add Cap blob after GroupName;

alter table endpoints modify ipaddr int(11) unsigned default '0';

alter table groups add EnforceVPort tinyint(1) NOT NULL default '0' after Cap;

alter table msws add Flag  smallint(6) NOT NULL default '0' after WritePassword;

alter table msws drop index MSWIp;

alter table msws add unique MSWName (MSWName);

alter table realms add MSWId smallint(6) NOT NULL default '-1' after GroupId;

DROP TABLE IF EXISTS trails;
CREATE TABLE trails (
  TrailId bigint(20) NOT NULL auto_increment,
  UserName varchar(32) NOT NULL default '',
  GroupId tinyint(1) NOT NULL default '-1',
  ClientAddr varchar(32) NOT NULL default '',
  DBAction varchar(32) NOT NULL default '',
  DBKey varchar(32) default NULL,
  Status varchar(32) default NULL,
  Detail blob,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (TrailId)
) TYPE=InnoDB PACK_KEYS=DEFAULT;

alter table iedgegroups add MSWId smallint(6) NOT NULL default '-1' after GroupId;

update groups set cap="<?xml version='1.0'?>\n<CAPABILITIES admin='true'>\n  <Report>\n  <Asr>\n      <Chromocode normal='60' questionable='58' />\n    </Asr>\n  <Business>\n      <Profit normal='5' questionable='0' />\n    </Business>\n    <Billing />\n  </Report>\n  <Alarm>\n    <Log read='false' readwrite='true' />\n    <CDR read='false' readwrite='true' />\n  </Alarm>\n</CAPABILITIES>";

#VERSION 3.2.1d4
#VERSION 3.2.1d5
#VERSION 3.2.1d5
#VERSION 3.2.1d6
use bn;
DROP TABLE IF EXISTS routesnames;
CREATE TABLE routesnames (
  GroupId tinyint(1) NOT NULL default '-1',
  CallPlanNames blob,
  CallRouteNames blob,
  CallBindingNames blob,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY (GroupId)
) TYPE=MyISAM PACK_KEYS=DEFAULT;
#VERSION 3.2.1d6
#VERSION 3.2.1d7
use bn;
DROP TABLE IF EXISTS CollectorType;
CREATE TABLE `CollectorType` (
  `CollectorType` varchar(45) NOT NULL default '',
  `TransportType` tinyint(1) NOT NULL default '0',
  `DescriptiveName` varchar(64) default NULL,
  `JavaClass` varchar(225) NOT NULL default '',
  PRIMARY KEY  (`CollectorType`)
) TYPE=MyISAM COMMENT='CDRStream Collector Agent table';

DROP TABLE IF EXISTS ConsumerType;
CREATE TABLE `ConsumerType` (
  `ConsumerType` varchar(45) NOT NULL default '',
  `DescriptiveName` varchar(64) default NULL,
  `JavaClass` varchar(255) NOT NULL default '',
  PRIMARY KEY  (`ConsumerType`)
) TYPE=MyISAM COMMENT='CDR Import Table for Consumers';

DROP TABLE IF EXISTS MappingType;
CREATE TABLE `MappingType` (
  `MappingID` int(10) unsigned NOT NULL auto_increment,
  `MappingXMLLocation` varchar(255) NOT NULL default '',
  `DescriptiveName` varchar(100) default NULL,
  PRIMARY KEY  (`MappingID`)
) TYPE=MyISAM ;

DROP TABLE IF EXISTS PipeLine;
CREATE TABLE `PipeLine` (
  `PipeLineID` int(10) unsigned NOT NULL auto_increment,
  `PipeLineDescription` varchar(45) default NULL,
  `PipeLineDebugLevel` varchar(10) NOT NULL default '',
  `CollectorType` varchar(45) NOT NULL default '',
  `ConsumerType` varchar(45) NOT NULL default '',
  `DeploymentStatus` varchar(20) NOT NULL default '0',
  `MappingID` int(10) unsigned NOT NULL default '0',
  `NextStartTime` datetime default NULL,
  `IntervalValue` int(10) unsigned default NULL,
  `CreateTime` datetime default NULL,
  `ModifiedTime` datetime NOT NULL default '0000-00-00 00:00:00',
  `SchedulerName` varchar(100) default NULL,
  `AutomaticStart` tinyint(3) unsigned NOT NULL default '0',
  `StreamType` varchar(45) NOT NULL default '',
  PRIMARY KEY  (`PipeLineID`)
) TYPE=MyISAM COMMENT='CDRStream - PipeLine table';

DROP TABLE IF EXISTS CollectorParams;
CREATE TABLE `CollectorParams` (
  `PipeLineID` int(10) unsigned NOT NULL default '0',
  `Name` varchar(45) NOT NULL default '',
  `Value` varchar(255) NOT NULL default '',
  UNIQUE KEY `Index` (`PipeLineID`,`Name`,`Value`)
) TYPE=MyISAM COMMENT='CollectorParams Table';

DROP TABLE IF EXISTS ConsumerParams;
CREATE TABLE `ConsumerParams` (
  `PipeLineID` int(10) unsigned NOT NULL default '0',
  `Name` varchar(45) NOT NULL default '',
  `Value` varchar(255) NOT NULL default '',
  UNIQUE KEY `Index` (`PipeLineID`,`Name`,`Value`)
) TYPE=MyISAM COMMENT='ConsumerParams Table';

alter table ivms-cdr-table add CallDstCustId varchar(64) NOT NULL default '' after UserAuth;
alter table ivms-cdr-table add CallZoneData  varchar(64) NOT NULL default '' after CallDstCustId;
alter table ivms-cdr-table add CallDstNumType varchar(64) NOT NULL default '' after CallZoneData;
alter table ivms-cdr-table add CallSrcNumType varchar(64) NOT NULL default '' after CallDstNumType;
alter table ivms-cdr-table add OrigISDNCauseCode varchar(64) NOT NULL default '' after CallSrcNumType;
alter table ivms-cdr-table add SrcPacketsReceived int(11) NOT NULL default '0' after OrigISDNCauseCode;
alter table ivms-cdr-table add SrcPacketsLost int(11) NOT NULL default '0' after SrcPacketsReceived;
alter table ivms-cdr-table add SrcPacketsDiscarded int(11) NOT NULL default '0' after SrcPacketsLost;
alter table ivms-cdr-table add SrcPDV int(11) NOT NULL default '0' after SrcPacketsDiscarded;
alter table ivms-cdr-table add SrcCodec varchar(24) NOT NULL default '' after SrcPDV;
alter table ivms-cdr-table add SrcLatency int(11) NOT NULL default '0' after SrcCodec;
alter table ivms-cdr-table add SrcRFactor smallint(6) NOT NULL default '0' after SrcLatency;
alter table ivms-cdr-table add DstPacketsReceived int (11) NOT NULL default '0' after SrcRFactor;
alter table ivms-cdr-table add DstPacketsLost int(11) NOT NULL default '0' after DstPacketsReceived;
alter table ivms-cdr-table add DstPacketsDiscarded int(11) NOT NULL default '0' after DstPacketsLost;
alter table ivms-cdr-table add DstPDV int(11) NOT NULL default '0' after DstPacketsDiscarded;
alter table ivms-cdr-table add DstCodec varchar(24) NOT NULL default '' after DstPDV;
alter table ivms-cdr-table add DstLatency int(11) NOT NULL default '0' after DstCodec;
alter table ivms-cdr-table add DstRFactor smallint(6) NOT NULL default '0' after DstLatency;

alter table endpoints change MSWId ClusterId smallint(6) NOT NULL default '-1' after GroupId;

alter table realms change MSWId ClusterId smallint(6) NOT NULL default '-1' after GroupId;

alter table iedgegroups change MSWId ClusterId smallint(6) NOT NULL default '-1' after GroupId;

alter table cdrsummary add SrcPacketsReceived int(11) NOT NULL default '0' after UserAuth;
alter table cdrsummary add SrcPacketsLost int(11) NOT NULL default '0' after SrcPacketsReceived;
alter table cdrsummary add SrcPDV int(11) NOT NULL default '0' after SrcPacketsLost;
alter table cdrsummary add SrcRFactor smallint(6) NOT NULL default '0' after SrcPDV;
alter table cdrsummary add DstPacketsReceived int (11) NOT NULL default '0' after SrcRFactor;
alter table cdrsummary add DstPacketsLost int(11) NOT NULL default '0' after DstPacketsReceived;
alter table cdrsummary add DstPDV int(11) NOT NULL default '0' after DstPacketsLost;
alter table cdrsummary add DstRFactor smallint(6) NOT NULL default '0' after DstPDV;

#VERSION 3.2.1d7
#VERSION 3.2.1d8
use bn;
alter table carrierplans add  GroupId tinyint(1) NOT NULL default '-1' after CarrierplanId;
update carrierplans, endpoints set carrierplans.GroupId=endpoints.GroupId where carrierplans.EndpointId=endpoints.EndpointId;
#VERSION 3.2.1d8
#VERSION 3.2.1d9
#VERSION 3.2.1d9
#VERSION 3.2.1d10
use bn;

UPDATE groups set cap="<?xml version='1.0'?>\n<CAPABILITIES admin='true'>\n  <Report>\n  <Asr>\n      <Chromocode normal='60' questionable='58' />\n    </Asr>\n  <Business>\n      <Profit normal='5' questionable='0' />\n    </Business>\n    <Billing />\n  </Report>\n  <Endpoints read=\"false\" readwrite=\"true\" />\n  <Routes read=\"false\" readwrite=\"true\">\n    <DialPlans readwrite=\"true\" />\n      </Routes>\n     <Rates read=\"false\" readwrite=\"true\" />\n   <Alarm ARM=\"true\">\n    <Log read='false' readwrite='true' />\n    <CDR read='false' readwrite='true' />\n     <Actions read=\"false\" ARM=\"true\" script=\"true\" generic=\"true\" />\n </Alarm>\n  <TimeZone>local</TimeZone>\n</CAPABILITIES>" where groupid = 1;

#VERSION 3.2.1d10
#VERSION 4.0d11
##
## drop the old buy and sell summary tables and create the new schema for them
use bn;
DROP TABLE IF EXISTS sellsummary;
CREATE TABLE sellsummary (
  SellSummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  OrigDesc varchar(64) NOT NULL default '',
  RegionCode varchar(32) NOT NULL default '',
  DestCountry varchar(64) NOT NULL default '',
  SellCarrier varchar(32) NOT NULL default '',
  SellPlan varchar(32) NOT NULL default '',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0',
  PDD int(11) NOT NULL default '0',
  SellRate float(10,4) NOT NULL default '0.0000',
  BuyPrice double(20,4) NOT NULL default '0.0000',
  SellPrice double(20,4) not null default '0.0000',
  CallCount int(11) NOT NULL default '0',
  BillableCount int(11) NOT NULL default '0',
  SellConnectCharge float(10,4) NOT NULL default '0.0000',
  SellRoundedSec bigint(11) NOT NULL default '0',
  BuyConnectCharge float(10,4) NOT NULL default '0.0000',
  BuyRoundedSec bigint(11) NOT NULL default '0',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  SellSummaryId (SellSummaryId),
  KEY DateTimeInt (DateTimeInt)
) TYPE=MyISAM PACK_KEYS=DEFAULT;


DROP TABLE IF EXISTS cdrsummary;
CREATE TABLE cdrsummary (
  CdrSummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  CDRFileId smallint(6) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  DiscCode char(2) NOT NULL default '',
  RegionCode varchar(32) default NULL,
  ErrorIdLeg1 mediumint(9) default NULL,
  ISDNCode mediumint(9) NOT NULL default '0',
  CallCount int(11) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0',
  PDD int(11) NOT NULL default '0',
  BuyCarrier varchar(32) NOT NULL default '',
  SellCarrier varchar(32) NOT NULL default '',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  SrcPacketsReceived int(11) NOT NULL default '0',
  SrcPacketsLost int(11) NOT NULL default '0',
  SrcPDV int(11) NOT NULL default '0',
  SrcRFactor smallint(6) NOT NULL default '0',
  DstPacketsReceived int (11) NOT NULL default '0',
  DstPacketsLost int(11) NOT NULL default '0',
  DstPDV int(11) NOT NULL default '0',
  DstRFactor smallint(6) NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (CdrSummaryId),
  KEY DateTimeInt (DateTimeInt),
  KEY CDRFileId (CDRFileId)
) TYPE=MyISAM PACK_KEYS=DEFAULT;



DROP TABLE IF EXISTS buysummary;
CREATE TABLE buysummary (
  BuySummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  DestDesc varchar(64) NOT NULL default '',
  RegionCode varchar(32) NOT NULL default '',
  OrigCountry varchar(64) NOT NULL default '',
  BuyCarrier varchar(32) NOT NULL default '',
  BuyPlan varchar(32) NOT NULL default '',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0.0000',
  PDD int(11) NOT NULL default '0',
  BuyRate float(10,4) NOT NULL default '0.0000',
  BuyPrice double(20,4) NOT NULL default '0.0000',
  SellPrice double(20,4) NOT NULL default '0.0000',
  CallCount int(11) NOT NULL default '0',
  BillableCount int(11) NOT NULL default '0',
  BuyConnectCharge float(10,4) NOT NULL default '0.0000',
  BuyRoundedSec bigint(11) NOT NULL default '0',
  SellConnectCharge float(10,4) NOT NULL default '0.0000',
  SellRoundedSec bigint(11) NOT NULL default '0',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  BuySummaryId (BuySummaryId),
  KEY DateTimeInt (DateTimeInt)
) TYPE=MyISAM PACK_KEYS=DEFAULT;
##
## now update the cdrlogs table to reset the summarizer bit for every cdr table entry
update cdrlogs set Status = (Status & ~2);

DROP TABLE IF EXISTS accesslist;
CREATE TABLE accesslist (
  ListId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  OwnerGroupId tinyint(1) NOT NULL default '-1',
  Realm varchar(31) binary NOT NULL default '',
  Endpoint varchar(67) binary NOT NULL default '',
  port int(11) NOT NULL default '-1',
  RegionCode  varchar(32) NOT NULL default '',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY (ListId),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON DELETE CASCADE,
  INDEX OwnerGroupId (OwnerGroupId),
  FOREIGN KEY (OwnerGroupId) REFERENCES groups(GroupId) ON DELETE CASCADE
) TYPE=InnoDB PACK_KEYS=DEFAULT;

alter table plans modify costcode varchar(64) NOT NULL default '';
alter table routes modify costcode varchar(64) NOT NULL default '';

alter table actions add Name varchar(32) NOT NULL after ActionId;
update actions set Name = ActionId where actionid !=-1;
update actions set Name = 'None Action' where actionid=-1;
alter table actions add UNIQUE Name (Name);
#VERSION 4.0d11
#VERSION 4.0t1
#VERSION 4.0t1
#VERSION 4.0t2
use bn;
alter table msws add UNIQUE KEY MSWIp (MSWIp);
#VERSION 4.0t2
#VERSION 4.0t3
use bn;
set @maxcluster = (select max(ClusterId)+1 from msws);
update msws set ClusterId = @maxcluster where ClusterId = '0';
update iedgegroups set ClusterId = @maxcluster where ClusterId = '0';
update realms set ClusterId = @maxcluster where ClusterId = '0';
update endpoints set ClusterId = @maxcluster where ClusterId = '0';

alter table cdrlogs modify CDRLogId int(11) unsigned NOT NULL auto_increment;
alter table ivms-cdr-table modify CDRLogId int(11) unsigned NOT NULL default '0';
alter table activitylogs modify CdrLogId int(11) unsigned NOT NULL;

alter table ivms-cdr-table modify CDRFileId int(11) unsigned NOT NULL default '0';
alter table cdrfiles modify CDRFileId int(11) unsigned NOT NULL auto_increment;
alter table cdrsummary modify CDRFileId int(11) unsigned NOT NULL default '0';

#VERSION 4.0t3
#VERSION 4.0t4
use bn;
CREATE TABLE IF NOT EXISTS tablestatus (
  tablename varchar(32) NOT NULL default '',
  status tinyint NOT NULL default 0,
  PRIMARY KEY  (tablename)
) TYPE=MyISAM PACK_KEYS=DEFAULT;

alter table sessions add ip int(11) unsigned default '0' after SessionId;

update users set cap= "<?xml version='1.0'?>\n<CAPABILITIES admin='true' root='true'>\n  <Report>\n  <Asr>\n      <Chromocode normal='60' questionable='58' />\n    </Asr>\n  <Business>\n      <Profit normal='5' questionable='0' />\n    </Business>\n    <Billing />\n  </Report>\n  <Endpoints read='false' readwrite='true' />\n  <Routes read='false' readwrite='true'>\n    <DialPlans readwrite='true' />\n  </Routes>\n  <Rates read='false' readwrite='true' />\n  <Alarm ARM='true'>\n    <Log read='false' readwrite='true' />\n    <CDR read='false' readwrite='true' />\n    <Actions read='false' ARM='true' script='true' generic='true' />\n  </Alarm>\n  <TimeZone>local</TimeZone>\n</CAPABILITIES>" where user='root' and groupId=1;

#VERSION 4.0t4
#VERSION 4.0t5
#VERSION 4.0t5
#VERSION 4.0t6
#VERSION 4.0t6
#VERSION 4.0c1
#VERSION 4.0c1

#VERSION 4.1d2
use bn;

DROP TABLE IF EXISTS subnets;
CREATE TABLE subnets(
  SubnetId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  ClusterId smallint(6) NOT NULL default '-1',
  Name varchar(67) binary NOT NULL default '',
  IPaddress int(11) unsigned default NULL,
  Mask int(11) unsigned default NULL,
  IEdgeGroupName varchar(31) binary NOT NULL default '',
  RealmName varchar(31) binary NOT NULL default '',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (SubnetId),
  UNIQUE KEY SubnetName (Name),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=MyISAM  PACK_KEYS=DEFAULT;

alter table iedgegroups add MaxBwIn int(11) default NULL after CallsTotal;
alter table iedgegroups add MaxBwOut int(11) default NULL after MaxBwIn;
alter table iedgegroups add MaxBwTotal int(11) default NULL after MaxBwOut;
alter table iedgegroups add Imr smallint(6) default NULL after MaxBwTotal;
alter table iedgegroups add Emr smallint(6) default NULL after Imr;
alter table endpoints add bandwidth int(11) NOT NULL default 0 after LastModified;
alter table endpoints add callingpartyType int(11) default NULL after bandwidth;
alter table ivms-cdr-table add SrcSipRespcode smallint(6) NOT NULL default '0' after DstRFactor;
alter table ivms-cdr-table add PeerProtocol smallint(6) NOT NULL default '0' after SrcSipRespcode;
alter table ivms-cdr-table add SrcPrivateIp int(11) unsigned NOT NULL default '0' after PeerProtocol;
alter table ivms-cdr-table add DstPrivateIp int(11) unsigned NOT NULL default '0' after SrcPrivateIp;
alter table ivms-cdr-table add SrcIgrpName varchar(24) NOT NULL default '' after DstPrivateIp;
alter table ivms-cdr-table add DstIgrpName varchar(24) NOT NULL default '' after SrcIgrpName;
#VERSION 4.1d2
#VERSION 4.1d3
#VERSION 4.1d3
#VERSION 4.1d4
alter table iedgegroups add Timeout int(11) default NULL after MaxBwTotal;
#VERSION 4.1d4
#VERSION 4.1d5
#VERSION 4.1d5
#VERSION 4.1d6
alter table ivms-cdr-table modify PeerProtocol varchar(24) NOT NULL default '' ;
#VERSION 4.1d6
#VERSION 4.1t1
alter table endpoints modify subnetip int(11) unsigned default NULL;
alter table endpoints modify subnetmask int(11) unsigned default NULL;
alter table endpoints modify natip int(11) unsigned default NULL;
alter table iedgegroups modify MaxIn int(11) NOT NULL default '0';
alter table iedgegroups modify MaxOut int(11) NOT NULL default '0';
alter table iedgegroups modify MaxTotal int(11) NOT NULL default '0';
alter table iedgegroups modify CallsIn int(11) NOT NULL default '0';
alter table iedgegroups modify CallsOut int(11) NOT NULL default '0';
alter table iedgegroups modify CallsTotal int(11) NOT NULL default '0';
alter table iedgegroups modify MaxBwIn int(11) NOT NULL default '0';
alter table iedgegroups modify MaxBwOut int(11) NOT NULL default '0';
alter table iedgegroups modify MaxBwTotal int(11) NOT NULL default '0';
alter table iedgegroups modify Timeout int(11) NOT NULL default '0';
alter table iedgegroups modify Imr smallint(6) NOT NULL default '-1';
alter table iedgegroups modify Emr smallint(6) NOT NULL default '-1';
alter table iedgegroups modify DndTime bigint(20) NOT NULL default '0';
alter table subnets modify IPaddress int(11) unsigned NOT NULL default '0';
alter table subnets modify Mask int(11) unsigned NOT NULL default '0';
#VERSION 4.1t1
#VERSION 4.1t2
use bn;

alter table cdrlogs modify CDRLogId int(11) unsigned NOT NULL auto_increment;
alter table ivms-cdr-table modify CDRLogId int(11) unsigned NOT NULL default '0';
alter table activitylogs modify CdrLogId int(11) unsigned NOT NULL;

alter table ivms-cdr-table modify CDRFileId int(11) unsigned NOT NULL default '0';
alter table cdrfiles modify CDRFileId int(11) unsigned NOT NULL auto_increment;
DROP TABLE IF EXISTS cdrsummary;
CREATE TABLE cdrsummary (
  CdrSummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  CDRFileId int(11) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  DiscCode char(2) NOT NULL default '',
  RegionCode varchar(32) default NULL,
  ErrorIdLeg1 mediumint(9) default NULL,
  ISDNCode mediumint(9) NOT NULL default '0',
  CallCount int(11) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0',
  PDD int(11) NOT NULL default '0',
  BuyCarrier varchar(32) NOT NULL default '',
  SellCarrier varchar(32) NOT NULL default '',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  SrcPacketsReceived int(11) NOT NULL default '0',
  SrcPacketsLost int(11) NOT NULL default '0',
  SrcPDV int(11) NOT NULL default '0',
  SrcRFactor smallint(6) NOT NULL default '0',
  DstPacketsReceived int (11) NOT NULL default '0',
  DstPacketsLost int(11) NOT NULL default '0',
  DstPDV int(11) NOT NULL default '0',
  DstRFactor smallint(6) NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (CdrSummaryId),
  KEY DateTimeInt (DateTimeInt),
  KEY CDRFileId (CDRFileId)
) TYPE=InnoDB PACK_KEYS=DEFAULT;

DROP TABLE IF EXISTS sellsummary;
CREATE TABLE sellsummary (
  SellSummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  OrigDesc varchar(64) NOT NULL default '',
  RegionCode varchar(32) NOT NULL default '',
  DestCountry varchar(64) NOT NULL default '',
  SellCarrier varchar(32) NOT NULL default '',
  SellPlan varchar(32) NOT NULL default '',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0',
  PDD int(11) NOT NULL default '0',
  SellRate float(10,4) NOT NULL default '0.0000',
  BuyPrice double(20,4) NOT NULL default '0.0000',
  SellPrice double(20,4) not null default '0.0000',
  CallCount int(11) NOT NULL default '0',
  BillableCount int(11) NOT NULL default '0',
  SellConnectCharge float(10,4) NOT NULL default '0.0000',
  SellRoundedSec bigint(11) NOT NULL default '0',
  BuyConnectCharge float(10,4) NOT NULL default '0.0000',
  BuyRoundedSec bigint(11) NOT NULL default '0',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  SellSummaryId (SellSummaryId),
  KEY DateTimeInt (DateTimeInt)
) TYPE=InnoDB PACK_KEYS=DEFAULT;


DROP TABLE IF EXISTS buysummary;
CREATE TABLE buysummary (
  BuySummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  DestDesc varchar(64) NOT NULL default '',
  RegionCode varchar(32) NOT NULL default '',
  OrigCountry varchar(64) NOT NULL default '',
  BuyCarrier varchar(32) NOT NULL default '',
  BuyPlan varchar(32) NOT NULL default '',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0.0000',
  PDD int(11) NOT NULL default '0',
  BuyRate float(10,4) NOT NULL default '0.0000',
  BuyPrice double(20,4) NOT NULL default '0.0000',
  SellPrice double(20,4) NOT NULL default '0.0000',
  CallCount int(11) NOT NULL default '0',
  BillableCount int(11) NOT NULL default '0',
  BuyConnectCharge float(10,4) NOT NULL default '0.0000',
  BuyRoundedSec bigint(11) NOT NULL default '0',
  SellConnectCharge float(10,4) NOT NULL default '0.0000',
  SellRoundedSec bigint(11) NOT NULL default '0',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  BuySummaryId (BuySummaryId),
  KEY DateTimeInt (DateTimeInt)
) TYPE=InnoDB PACK_KEYS=DEFAULT;
## now update the cdrlogs table to reset the summarizer bit for every cdr table entry
update cdrlogs set Status = (Status & ~2);
#VERSION 4.1t2

#VERSION 4.1t3
use bn;
alter table routesnames modify CallPlanNames longblob, modify CallRouteNames longblob, modify CallBindingNames longblob;
#VERSION 4.1t3
#VERSION 4.1t4
DROP TABLE IF EXISTS callingplans;
CREATE TABLE callingplans (
  Id bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  ClusterId smallint(6) NOT NULL default '-1',
  Name varchar(59) binary NOT NULL default '',
	Vpng varchar(79) binary NOT NULL default '',
	RefreshTime bigint(20)  NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (Id),
  UNIQUE KEY Name (ClusterId,Name),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=InnoDB PACK_KEYS=DEFAULT;


DROP TABLE IF EXISTS cpbindings;
CREATE TABLE cpbindings (
  Id bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  ClusterId smallint(6) NOT NULL default '-1',
  CPName varchar(59) binary NOT NULL default '',
  CRName varchar(59) binary NOT NULL default '',
  RefreshTime bigint(20) default NULL,
  StartSec int(11) NOT NULL default '0',
  StartMin int(11) NOT NULL default '0',
	StartHour int(11)  NOT NULL default '0',
	StartMDay int(11)  NOT NULL default '0',
	StartMon int(11)  NOT NULL default '0',
	StartYear int(11)  NOT NULL default '0',
	StartWDay int(11)  NOT NULL default '0',
	StartYDay int(11)  NOT NULL default '0',
	StartIsDst int(11)  NOT NULL default '0',
	EndSec int(11)  NOT NULL default '0',
	EndMin int(11)  NOT NULL default '0',
	EndHour int(11)  NOT NULL default '0',
	EndMDay int(11)  NOT NULL default '0',
	EndMon int(11)  NOT NULL default '0',
	EndYear int(11)  NOT NULL default '0',
	EndWDay int(11)  NOT NULL default '0',
	EndYDay int(11)  NOT NULL default '0',
	EndIsDst int(11)  NOT NULL default '0',
	Priority int(11)  NOT NULL default '0',
	Flag int(11)  NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (Id),
  UNIQUE KEY Name (ClusterId,CPName,CRName),
  KEY CPName(CPName),
  Key CRName(CRName),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=InnoDB PACK_KEYS=DEFAULT;

DROP TABLE IF EXISTS callingroutes;
CREATE TABLE callingroutes(
  Id bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default '-1',
  ClusterId smallint(6) NOT NULL default '-1',
  Name varchar(59) binary NOT NULL default '',
	Dest varchar(63) binary NOT NULL default '',
  Prefix varchar(63) binary NOT NULL default '',
	SrcPrefix varchar(63) binary NOT NULL default '',
  RefreshTime bigint(20)  NOT NULL default '0',
  SrcPresent tinyint(4)  NOT NULL default '0',
  Src varchar(63) binary NOT NULL default '',
  SrcLen int(11)  NOT NULL default '0',
  DestLen int(11)  NOT NULL default '0',
  RouteFlags int(11)  NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (Id),
  UNIQUE KEY Name (ClusterId,Name),
  Key CRName(Name,Src,Dest),
  INDEX GroupId (GroupId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON UPDATE CASCADE ON DELETE CASCADE
)TYPE=InnoDB PACK_KEYS=DEFAULT;

alter table carrierplans add RatingAddback varchar(16) NOT NULL default '' after AddbackDigits;

DROP TABLE IF EXISTS cdrsummary;
CREATE TABLE cdrsummary (
  CdrSummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  CDRFileId int(11) NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  DiscCode char(2) NOT NULL default '',
  RegionCode varchar(32) default NULL,
  ErrorIdLeg1 mediumint(9) default NULL,
  ISDNCode mediumint(9) NOT NULL default '0',
  CallCount int(11) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0',
  PDD int(11) NOT NULL default '0',
  BuyCarrier varchar(32) NOT NULL default '',
  SellCarrier varchar(32) NOT NULL default '',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','
19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38
','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54',
'55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  SrcPacketsReceived int(11) NOT NULL default '0',
  SrcPacketsLost int(11) NOT NULL default '0',
  SrcPDV int(11) NOT NULL default '0',
  SrcRFactor smallint(6) NOT NULL default '0',
  DstPacketsReceived int (11) NOT NULL default '0',
  DstPacketsLost int(11) NOT NULL default '0',
  DstPDV int(11) NOT NULL default '0',
  DstRFactor smallint(6) NOT NULL default '0',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (CdrSummaryId),
  KEY DateTimeInt (DateTimeInt),
  KEY CDRFileId (CDRFileId)
) TYPE=InnoDB PACK_KEYS=DEFAULT;

#VERSION 4.1t4

#VERSION 4.1t5
alter table cdrfiles add index SrcFileName (SrcFileName);
use bn;
REPLACE INTO users VALUES (1,'root',1,'hGyVtnlrHBskPMTU5frLr59NWpU=',"<?xml version='1.0'?>\n<CAPABILITIES admin='true' sysadmin='true' root='true'>\n  <Report>\n  <Asr>\n      <Chromocode normal='60' questionable='58' />\n    </Asr>\n  <Business>\n      <Profit normal='5' questionable='0' />\n    </Business>\n    <Billing />\n  </Report>\n  <Endpoints read='false' readwrite='true' />\n  <Routes read='false' readwrite='true'>\n    <DialPlans readwrite='true' />\n  </Routes>\n  <Rates read='false' readwrite='true' />\n  <Alarm ARM='true'>\n    <Log read='false' readwrite='true' />\n    <CDR read='false' readwrite='true' />\n    <Actions read='false' ARM='true' script='true' generic='true' />\n  </Alarm>\n  <TimeZone>local</TimeZone>\n</CAPABILITIES>",now(),now());
#VERSION 4.1t5
#VERSION 4.1c1
use bn;
alter table carrierplans type=InnoDB;
alter table plans type=InnoDB;
alter table routes type=InnoDB;
alter table periods type=InnoDB;
truncate services;
alter table services add Name varchar(32) NOT NULL AFTER ServiceId;

DROP TABLE IF EXISTS ratesummary;
CREATE TABLE ratesummary (
  RateSummaryId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default -1,
  CarrierplanId bigint(20) NOT NULL default -1,
  EndpointId bigint(20) NOT NULL default '-1',
  RouteId bigint(20) NOT NULL default -1,
  PlanId bigint(20) NOT NULL default -1,
  RouteGroup varchar(32) NOT NULL default '',
  Plan varchar(32) NOT NULL default '',
  RegionCode varchar(32) NOT NULL default '',
  Carrier varchar(32) NOT NULL default '',
  CostCode varchar(64) NOT NULL default '',
  BuySell char(1) NOT NULL default '',
  Rate float(10,4) NOT NULL default '0.0000',
  EffectiveStartDate datetime default NULL,
  EffectiveEndDate datetime default NULL,
  PeriodId bigint(20) NOT NULL default '-1',
  Period varchar(32) NOT NULL default '',
  Zone varchar(32) default NULL,
  StartWeekDays mediumint(9) NOT NULL default '-1',
  EndWeekDays mediumint(9) NOT NULL default '-1',
  StartTime TIME default NULL,
  EndTime TIME default NULL,
  Realmname varchar(31) binary NOT NULL default '',
  SerialNumber varchar(67) binary NOT NULL default '',
  port int(11) NOT NULL default '0',
  flag tinyint(1) NOT NULL default '0',
  StripPrefix varchar(32) NOT NULL default '',
  AddbackDigits varchar(16) NOT NULL default '',
  ANI varchar(32) NOT NULL default '',
  Valid tinyint(1) NOT NULL default '1',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (RateSummaryId),
  UNIQUE KEY RateSummary_key (GroupId,RegionCode,EndpointId,BuySell,RouteGroup,Plan,PeriodId),
  KEY Carrier (Carrier),
  KEY Region (RegionCode),
  KEY CostCode (CostCode),
  KEY Plan (Plan),
  KEY Period (Period),
  INDEX GroupId (GroupId),
  INDEX CarrierPlanId (CarrierPlanId),
  INDEX Endpoint (EndpointId),
  INDEX PeriodId (PeriodId),
  INDEX RouteId (RouteId),
  INDEX PlanId (PlanId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON DELETE CASCADE,
  FOREIGN KEY (CarrierplanId) REFERENCES carrierplans(CarrierplanId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (EndpointId) REFERENCES endpoints(EndpointId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (RouteId) REFERENCES routes(RouteId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PlanId) REFERENCES plans(PlanId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PeriodId) REFERENCES periods(PeriodId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=InnoDB PACK_KEYS=DEFAULT;


#VERSION 4.1c1
#VERSION 4.2d1
alter table trails add sid varchar(64) NOT NULL default '' after Created;
alter table cdrfiles drop index SrcFileName;
alter table services drop column Name;
#VERSION 4.2d1

#VERSION 4.2d2
#VERSION 4.2d2

#VERSION 4.2d3
use bn;

DROP TABLE IF EXISTS ratesummary;
CREATE TABLE ratesummary (
  RateSummaryId bigint(20) NOT NULL auto_increment,
  GroupId tinyint(1) NOT NULL default -1,
  CarrierplanId bigint(20) NOT NULL default -1,
  EndpointId bigint(20) NOT NULL default '-1',
  RouteId bigint(20) NOT NULL default -1,
  PlanId bigint(20) NOT NULL default -1,
  RouteGroup varchar(32) NOT NULL default '',
  Plan varchar(32) NOT NULL default '',
  RegionCode varchar(32) NOT NULL default '',
  Carrier varchar(32) NOT NULL default '',
  CostCode varchar(64) NOT NULL default '',
  BuySell char(1) NOT NULL default '',
  Rate float(10,4) NOT NULL default '0.0000',
  EffectiveStartDate datetime default NULL,
  EffectiveEndDate datetime default NULL,
  PeriodId bigint(20) NOT NULL default '-1',
  Period varchar(32) NOT NULL default '',
  Zone varchar(32) default NULL,
  StartWeekDays mediumint(9) NOT NULL default '-1',
  EndWeekDays mediumint(9) NOT NULL default '-1',
  StartTime TIME default NULL,
  EndTime TIME default NULL,
  Realmname varchar(31) binary NOT NULL default '',
  SerialNumber varchar(67) binary NOT NULL default '',
  port int(11) NOT NULL default '0',
  flag tinyint(1) NOT NULL default '0',
  StripPrefix varchar(32) NOT NULL default '',
  AddbackDigits varchar(16) NOT NULL default '',
  ANI varchar(32) NOT NULL default '',
  Valid tinyint(1) NOT NULL default '1',
  Created datetime NOT NULL default '0000-00-00 00:00:00',
  LastModified datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (RateSummaryId),
  UNIQUE KEY RateSummary_key (GroupId,RegionCode,EndpointId,BuySell,RouteGroup,Plan,PeriodId),
  KEY Carrier (Carrier),
  KEY Region (RegionCode),
  KEY CostCode (CostCode),
  KEY Plan (Plan),
  KEY Period (Period),
  INDEX GroupId (GroupId),
  INDEX CarrierPlanId (CarrierPlanId),
  INDEX Endpoint (EndpointId),
  INDEX PeriodId (PeriodId),
  INDEX RouteId (RouteId),
  INDEX PlanId (PlanId),
  FOREIGN KEY (GroupId) REFERENCES groups(GroupId) ON DELETE CASCADE,
  FOREIGN KEY (CarrierplanId) REFERENCES carrierplans(CarrierplanId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (EndpointId) REFERENCES endpoints(EndpointId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (RouteId) REFERENCES routes(RouteId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PlanId) REFERENCES plans(PlanId) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY (PeriodId) REFERENCES periods(PeriodId) ON UPDATE CASCADE ON DELETE CASCADE
) TYPE=InnoDB PACK_KEYS=DEFAULT;


ALTER TABLE endpoints DROP INDEX Ep_Port,
ADD UNIQUE KEY Ep_Port (serialNumber,Port,ClusterId);

ALTER TABLE cdrfiles
ADD KEY SrcFileName (SrcFileName);

ALTER TABLE services
ADD COLUMN   Name varchar(32) NOT NULL AFTER ServiceId;

ALTER TABLE iedgegroups
DROP INDEX IEdgeGroupName,
ADD   UNIQUE KEY IEdgeGroupName (ClusterId,Name);

ALTER TABLE carrierplans
ADD FOREIGN KEY `carrierplans_ibfk_1` (`EndpointId`) REFERENCES `endpoints` (`EndpointId`) ON DELETE CASCADE ON UPDATE CASCADE,
Type=InnoDB;

ALTER TABLE routes
Type=InnoDB;

ALTER TABLE periods
Type=InnoDB;

ALTER TABLE plans
ADD FOREIGN KEY `plans_ibfk_1` (`PeriodId`) REFERENCES `periods` (`PeriodId`) ON DELETE CASCADE ON UPDATE CASCADE,
Type=InnoDB;





#VERSION 4.2d3


#VERSION 4.2d4

ALTER TABLE callingplans DROP FOREIGN KEY `callingplans_ibfk_1`;
ALTER TABLE callingplans CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD KEY PartitionId(PartitionId),
ADD CONSTRAINT `callingplans_ibfk_1` FOREIGN KEY `callingplans_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
ADD COLUMN PcpName varchar(59) binary NOT NULL default ' ' AFTER RefreshTime,
ADD COLUMN Version int(11) NOT NULL default '0' AFTER PcpName;

ALTER TABLE callingroutes DROP FOREIGN KEY `callingroutes_ibfk_1`;
ALTER TABLE callingroutes CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';
ALTER TABLE callingroutes DROP INDEX GroupId, ADD KEY PartitionId(PartitionId),
ADD CONSTRAINT `callingroutes_ibfk_1` FOREIGN KEY `callingroutes_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
DROP INDEX Name,
ADD COLUMN TmpsrcPrefix varchar(47) default NULL,
ADD COLUMN LastUseTime bigint(20) default NULL,
ADD COLUMN CPName varchar(59) default '',
ADD COLUMN TRName varchar(27) default '',
ADD COLUMN StartTime bigint(20),
ADD COLUMN EndTime bigint(20),
ADD COLUMN Version int(11) NOT NULL default '0',
ADD UNIQUE ClusterId_CRName (ClusterId,name);

ALTER TABLE carrierplans
DROP FOREIGN KEY carrierplans_ibfk_1;

ALTER TABLE ratesummary
DROP FOREIGN KEY ratesummary_ibfk_3;

ALTER TABLE endpoints DROP FOREIGN KEY `endpoints_ibfk_1`;
ALTER TABLE endpoints
DROP PRIMARY KEY,
CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
CHANGE EndpointId Id bigint(20) NOT NULL auto_increment,
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId),
DROP INDEX Ep_Port,
DROP COLUMN proxyValid,
DROP COLUMN isProxied,
DROP COLUMN isProxying,
DROP COLUMN callForwarded,
DROP COLUMN currentCalls,
ADD COLUMN MSWName varchar(255) NOT NULL default  '',
ADD COLUMN CrId int(11),
ADD COLUMN RealmId int(11),
ADD COLUMN Redirectprotocol int(11),
ADD COLUMN SFlags int(11) NOT NULL default '0',
ADD COLUMN NSFlags int(11) NOT NULL default '0',
ADD COLUMN RejectTime datetime NOT NULL default '1971-01-01 00:00:00',
ADD COLUMN RasIp int(11) ,
ADD COLUMN Ports BLOB default NULL,
ADD COLUMN NPorts int(11) ,
ADD COLUMN CfgPorts BLOB default NULL,
ADD COLUMN NCfgPorts int(11) ,
ADD COLUMN QVal varchar(31) NOT NULL default '',
ADD COLUMN Dfags int(11) NOT NULL default '0',
ADD COLUMN MirrorProxyToHost varchar(255) NOT NULL default '',
ADD COLUMN MirrorProxyFromHost varchar(255) NOT NULL default '',
ADD COLUMN OBPHost varchar(255) ,
ADD COLUMN OBPRegistrationTime int(11),
ADD COLUMN OBPRegistrationXFactor int(11) ,
ADD COLUMN ResolvedUriIps BLOB,
ADD COLUMN CdcPrflName varchar(32) ,
ADD COLUMN Pt2833 int(11) ,
ADD COLUMN AgeTime int(11) ,
ADD COLUMN MpxyNonRegToHost varchar(255),
ADD COLUMN MpxyNonRegFromHost varchar(255),
ADD COLUMN PolicyKey int(11) ,
ADD COLUMN ElemKey int(11) ,
ADD COLUMN Ecaps2 int(11) ,
ADD COLUMN ClirData char(1) ,
ADD COLUMN CallDuration int(11) ,
ADD COLUMN Version int(11) NOT NULL DEFAULT 0,
ADD CONSTRAINT FOREIGN KEY `endpoints_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
ADD PRIMARY KEY(Id),
ADD UNIQUE Ep_Sno_Port  (clusterId,serialNumber,Port);

ALTER TABLE carrierplans
DROP INDEX EpId_Flag,
CHANGE COLUMN EndpointId Id bigint(20) NOT NULL default '-1',
ADD UNIQUE EpId_Flag (Id,BuySell),
ADD CONSTRAINT carrierplans_ibfk_1 FOREIGN KEY carrierplans_ibfk_1 (Id) REFERENCES endpoints(Id) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CollectorParams
DROP INDEX `Index`,
ADD UNIQUE KEY `PipeLineID` (`PipeLineID`,`Name`,`Value`);

ALTER TABLE ConsumerParams
DROP INDEX `Index`,
ADD UNIQUE KEY `PipeLineID` (`PipeLineID`,`Name`,`Value`);


ALTER TABLE cpbindings DROP FOREIGN KEY `cpbindings_ibfk_1`;
ALTER TABLE cpbindings CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId,
ADD KEY PartitionId(PartitionId),
ADD CONSTRAINT `cpbindings_ibfk_1` FOREIGN KEY `cpbindings_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
ADD COLUMN Version int(11) NOT NULL default '0' AFTER Flag;

ALTER TABLE filters DROP FOREIGN KEY filters_ibfk_2;

ALTER TABLE users
DROP INDEX User_Pass,
DROP INDEX User_Group,
CHANGE COLUMN User UserName varchar(32) NOT NULL default '',
CHANGE COLUMN Password PasswordId varchar(32) default NULL,
ADD KEY User_Pass (UserName,PasswordId),
ADD UNIQUE User_Group (UserName,GroupId);


ALTER TABLE filters
DROP INDEX Group_User_Name,
DROP INDEX User,
CHANGE COLUMN User UserName varchar(32) NOT NULL default '',
ADD UNIQUE Group_User_Name (GroupId, UserName, FilterName),
ADD KEY UserName (UserName),
ADD CONSTRAINT filters_ibfk_2 FOREIGN KEY filters_ibfk_2 (UserName) REFERENCES users(UserName) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE iedgegroups CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD KEY PartitionId(PartitionId),
ADD CONSTRAINT `iedgegroups_ibfk_1` FOREIGN KEY `iedgegroups_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
DROP COLUMN CallsIn,
DROP COLUMN CallsOut,
DROP COLUMN CallsTotal,
DROP COLUMN DndTime,
ADD COLUMN  XFactor smallint(6) NOT NULL default '0' AFTER Emr,
Type =InnoDB;

ALTER TABLE msws
ADD COLUMN MswUsername varchar (16),
ADD COLUMN MswPassword varchar (16),
ADD COLUMN MswPort int (4) default '3306',
ADD COLUMN MswDB varchar (32) default '127.0.0.1',
Type=InnoDB;

ALTER TABLE PipeLine
ADD COLUMN `LastCDRProcessed` datetime default NULL,
ADD COLUMN `LastExecStatus` int(10) default '0';

ALTER TABLE ratesummary
ADD CONSTRAINT ratesummary_ibfk_3 FOREIGN KEY ratesummary_ibfk_3 (EndpointId) REFERENCES endpoints(Id) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE realms CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId),
DROP PRIMARY KEY,
DROP INDEX RealmName,
CHANGE COLUMN RealmId RealmId bigint(20) default NULL,
CHANGE COLUMN Id Id bigint(20) NOT NULL auto_increment,
ADD COLUMN Flags int(11),
ADD COLUMN RealmPanasonic int(11),
ADD COLUMN Sig1qPriority int(11) ,
ADD COLUMN Med1qPriority  int(11) ,
ADD COLUMN SigIPTOS int(11) ,
ADD COLUMN MedIPTOS BLOB ,
ADD COLUMN Version int(11) NOT NULL DEFAULT 0,
ADD PRIMARY KEY  (Id),
ADD UNIQUE RealmName (ClusterId,Name),
ADD CONSTRAINT `realms_ibfk_1` FOREIGN KEY `realms_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
Type=InnoDB;

ALTER TABLE `sessions` CHANGE COLUMN `User` `UserName` VARCHAR(32) NOT NULL,
 DROP PRIMARY KEY,
 ADD PRIMARY KEY(`SessionId`),
 DROP INDEX `SessionId`;

#ALTER TABLE subnets DROP FOREIGN KEY `subnets_ibfk_1`;
ALTER TABLE subnets CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId),
DROP PRIMARY KEY,
DROP INDEX SubnetName,
ADD UNIQUE KEY `SubnetName` (`ClusterId`,`Name`),
CHANGE COLUMN SubnetId Id bigint(20) NOT NULL auto_increment,
ADD COLUMN Version int(11) NOT NULL default '0' AFTER RealmName,
ADD PRIMARY KEY (Id),
ADD CONSTRAINT `subnets_ibfk_1` FOREIGN KEY `subnets_ibfk_1`(PartitionId) REFERENCES groups(GroupId) ON DELETE CASCADE ON UPDATE CASCADE,
TYPE =InnoDB;

DROP TABLE IF EXISTS `triggers`;
CREATE TABLE  `triggers` (
  `Id` bigint(20) NOT NULL auto_increment,
  `PartitionId` tinyint(1) NOT NULL default '-1',
  `ClusterId` smallint(6) NOT NULL default '-1',
  `Name` varchar(27) character set latin1 collate latin1_bin NOT NULL default '',
  `Event` int(11) default NULL,
  `Data` varchar(27) character set latin1 collate latin1_bin NOT NULL default '',
  `SrcVendor` int(11) default NULL,
  `DstVendor` int(11) default NULL,
  `Action` int(11) default NULL,
  `Actionflags` int(11) default NULL,
  `Version` int(11) NOT NULL default '0',
  `Created` datetime NOT NULL default '0000-00-00 00:00:00',
  `LastModified` datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (`Id`),
  UNIQUE KEY `ClusterId_name` (`ClusterId`,`Name`),
  KEY `name` (`Name`),
  KEY `PartitionId` (`PartitionId`),
  FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`GroupId`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

DROP TABLE IF EXISTS `vnet`;
CREATE TABLE  `vnet` (
  `Id` bigint(20) NOT NULL auto_increment,
  `PartitionId` tinyint(1) NOT NULL default '-1',
  `ClusterId` smallint(6) NOT NULL default '-1',
  `Name` varchar(31) character set latin1 collate latin1_bin NOT NULL default '',
  `IfName` varchar(16) character set latin1 collate latin1_bin NOT NULL default '',
  `VnetId` int(11) default NULL,
  `RtgTblId` int(11) default NULL,
  `Gateway` varchar(67) character set latin1 collate latin1_bin NOT NULL default '',
  `Created` datetime NOT NULL default '0000-00-00 00:00:00',
  `LastModified` datetime NOT NULL default '0000-00-00 00:00:00',
  `Version` int(11) NOT NULL default '0',
  PRIMARY KEY  (`Id`),
  UNIQUE KEY `ClusterId_name` (`ClusterId`,`Name`),
  KEY `PartitionId` (`PartitionId`),
  FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`GroupId`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;




DROP TABLE IF EXISTS `cdcprofiles`;
CREATE TABLE  `cdcprofiles` (
  `Id` bigint(20) NOT NULL auto_increment,
  `PartitionId` tinyint(1) NOT NULL default '-1',
  `ClusterId` smallint(6) NOT NULL default '-1',
  `Name` varchar(31) character set latin1 collate latin1_bin NOT NULL,
  `NumPreferred` int(11) default NULL,
  `Preferrred` blob NOT NULL,
  `NumProhibited` int(11) default NULL,
  `Prohibited` blob NOT NULL,
  `Version` int(11) NOT NULL default '0',
  `Created` datetime NOT NULL default '0000-00-00 00:00:00',
  `LastModified` datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (`Id`),
  UNIQUE KEY `Name` (`ClusterId`,`Name`),
  KEY `PartitionId` (`PartitionId`),
  FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`GroupId`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

#VERSION 4.2d4

#VERSION 4.2d5

DROP TABLE IF EXISTS `dbdiff`;
CREATE TABLE `dbdiff` (
  `DBDiffId` bigint(20) NOT NULL auto_increment,
  `TableName` varchar(32) NOT NULL default '',
  `ClusterId` smallint(6) NOT NULL,
  `Owner` varchar(16) NOT NULL default '',
  `Cause` varchar(16) NOT NULL default '',
  `Key1` varchar(16) NOT NULL default '',
  `Key2` varchar(16) NOT NULL default '',
  `Key3` varchar(16) NOT NULL default '',
  `Key4` varchar(16) NOT NULL default '',
  `Created` datetime NOT NULL default '0000-00-00 00:00:00',
  `LastModified` datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (`DBDiffId`),
  UNIQUE KEY `Table_Cluster_Key` (`TableName`,`ClusterId`,`Key1`,`Key2`,`Key3`,`Key4`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


ALTER TABLE accesslist DROP FOREIGN KEY `accesslist_ibfk_1`, DROP FOREIGN KEY `accesslist_ibfk_2`;
ALTER TABLE callingplans DROP FOREIGN KEY `callingplans_ibfk_1`;
ALTER TABLE callingroutes DROP FOREIGN KEY `callingroutes_ibfk_1`;
ALTER TABLE cdcprofiles DROP FOREIGN KEY `cdcprofiles_ibfk_1`;
ALTER TABLE endpoints DROP FOREIGN KEY `endpoints_ibfk_1`;
ALTER TABLE filters DROP FOREIGN KEY `filters_ibfk_1`;
ALTER TABLE iedgegroups DROP FOREIGN KEY `iedgegroups_ibfk_1`;
ALTER TABLE ratesummary DROP FOREIGN KEY `ratesummary_ibfk_1`;
ALTER TABLE realms DROP FOREIGN KEY `realms_ibfk_1`;
ALTER TABLE subnets DROP FOREIGN KEY `subnets_ibfk_1`;
ALTER TABLE triggers DROP FOREIGN KEY `triggers_ibfk_1`;
ALTER TABLE users DROP FOREIGN KEY `users_ibfk_1`;
ALTER TABLE vnet DROP FOREIGN KEY `vnet_ibfk_1`;
ALTER TABLE cpbindings DROP FOREIGN KEY `cpbindings_ibfk_1`;

ALTER TABLE groups
CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP PRIMARY KEY,
ADD PRIMARY KEY(PartitionId);

ALTER TABLE accesslist CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId),
ADD CONSTRAINT `accesslist_ibfk_1` FOREIGN KEY `accesslist_ibfk_1` (PartitionId) REFERENCES groups (PartitionId) ON DELETE CASCADE,
ADD CONSTRAINT `accesslist_ibfk_2` FOREIGN KEY (OwnerGroupId) REFERENCES groups (PartitionId) ON DELETE CASCADE;

ALTER TABLE filters CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
ADD CONSTRAINT `filters_ibfk_1` FOREIGN KEY `filters_ibfk_1`(PartitionId) REFERENCES groups(PartitionId) ON DELETE CASCADE ON UPDATE CASCADE;


ALTER TABLE actions CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';
ALTER TABLE carrierplans CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';
ALTER TABLE alarms CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';
ALTER TABLE events CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';
ALTER TABLE ANI CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX ANI_Call_GroupId,
ADD UNIQUE KEY `ANI_Call_GroupId` (`ANI`,`CallNumber`,`PartitionId`);

ALTER TABLE iedgegroups ADD CONSTRAINT `iedgegroups_ibfk_1` FOREIGN KEY `iedgegroups_ibfk_1`(PartitionId) REFERENCES groups(PartitionId) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE msws
ADD COLUMN `AutosyncMaster` tinyint(1) NOT NULL default '-1';

ALTER TABLE periods CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE plans CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE ratesummary CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId),
ADD CONSTRAINT `ratesummary_ibfk_1` FOREIGN KEY `ratesummary_ibfk_1`(PartitionId) REFERENCES groups(PartitionId) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE realms
ADD CONSTRAINT `realms_ibfk_1` FOREIGN KEY `realms_ibfk_1`(PartitionId) REFERENCES groups(PartitionId) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE regions CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId);

ALTER TABLE routes CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE routesnames CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE services CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE sessions CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE subnets
ADD CONSTRAINT `subnets_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE trails CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1';

ALTER TABLE triggers
ADD CONSTRAINT `triggers_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE users CHANGE GroupId PartitionId tinyint(1) NOT NULL default '-1',
DROP INDEX GroupId, ADD INDEX PartitionId(PartitionId),
ADD CONSTRAINT `users_ibfk_1` FOREIGN KEY `users_ibfk_1`(PartitionId) REFERENCES groups(PartitionId) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE vnet
ADD CONSTRAINT `vnet_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE cpbindings
ADD CONSTRAINT `cpbindings_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE callingplans
ADD CONSTRAINT `callingplans_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE callingroutes
ADD CONSTRAINT `callingroutes_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE cdcprofiles
ADD CONSTRAINT `cdcprofiles_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE endpoints
ADD CONSTRAINT `endpoints_ibfk_1` FOREIGN KEY (`PartitionId`) REFERENCES `groups` (`PartitionId`) ON DELETE CASCADE ON UPDATE CASCADE;


#VERSION 4.2d5

#VERSION 4.2d6

ALTER TABLE accesslist
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1',
CHANGE COLUMN `OwnerGroupId` `OwnerGroupId` tinyint(2) NOT NULL default '-1';

ALTER TABLE actions
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE alarms
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1',
CHANGE COLUMN `Status` `Status` tinyint(2) NOT NULL default '0';

ALTER TABLE ANI
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

DROP TABLE IF EXISTS `ANIroutenames`;
CREATE TABLE  `ANIroutenames` (
  `ANI` varchar(32) NOT NULL default '',
  `BuySell` char(1) NOT NULL default '',
  `CallRouteNames` blob,
  `status` tinyint(2) NOT NULL default '0',
  PRIMARY KEY  (`ANI`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;


ALTER TABLE callingplans
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP INDEX Name,
ADD UNIQUE KEY `Name` (`Name`,`ClusterId`);

ALTER TABLE callingroutes
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP COLUMN TmpsrcPrefix,
ADD COLUMN `RegionCode` varchar(32) NOT NULL default '',
DROP INDEX  ClusterId_CRName,
ADD UNIQUE KEY `ClusterId_CRName` (`Name`,`ClusterId`);


DROP TABLE IF EXISTS `ratesummary`;
DROP TABLE IF EXISTS `carrierplans`;

DROP TABLE IF EXISTS `carriers`;
CREATE TABLE  `carriers` (
  `CarrierId` bigint(20) NOT NULL auto_increment,
  `Carrier` varchar(32) NOT NULL default '',
  `RegionCode` varchar(32) NOT NULL default '',
  `ServiceType` varchar(8) NOT NULL default '',
  `Priority` int(11) NOT NULL default '0',
  `ANI` varchar(32) NOT NULL default '',
  `StripPrefix` varchar(32) NOT NULL default '',
  `PrefixDigits` mediumint(9) NOT NULL default '0',
  `AddbackDigits` varchar(16) NOT NULL default '',
  `RatingAddback` varchar(16) NOT NULL default '',
  `EndpointId` bigint(20) NOT NULL default '-1',
  `flag` tinyint(2) NOT NULL default '0',
  `DurMin` mediumint(9) NOT NULL default '0',
  `DurIncr` mediumint(9) NOT NULL default '0',
  `Rate` float(10,4) NOT NULL default '0.0000',
  `Country` varchar(64) NOT NULL default '',
  `ConnectionCharge` float(10,4) NOT NULL default '0.0000',
  `EffectiveStartDate` datetime default '0000-00-00 00:00:00',
  `EffectiveEndDate` datetime default '0000-00-00 00:00:00',
  `Period` varchar(32) NOT NULL default '',
  `status` tinyint(2) NOT NULL default '0',
  `Created` datetime NOT NULL default '0000-00-00 00:00:00',
  `LastModified` datetime NOT NULL default '0000-00-00 00:00:00',
  PRIMARY KEY  (`CarrierId`),
  UNIQUE KEY `ep_para` (`EndpointId`,`StripPrefix`,`AddbackDigits`,`ANI`),
  UNIQUE KEY `carrier_key` (`Carrier`,`RegionCode`,`EndpointId`,`EffectiveStartDate`,`EffectiveEndDate`,`Period`),
  KEY `CarrierRegion` (`Carrier`,`RegionCode`),
  KEY `Region` (`RegionCode`),
  KEY `ANI` (`ANI`),
  KEY `Endpoint` (`EndpointId`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


ALTER TABLE cdcprofiles
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP INDEX Name,
ADD UNIQUE KEY `Name` (`Name`,`ClusterId`);

ALTER TABLE ivms-cdr-table
CHANGE COLUMN Status `Status` tinyint(2) NOT NULL default '-1';

ALTER TABLE CollectorType
CHANGE COLUMN   TransportType `TransportType` tinyint(2) NOT NULL default '0';

ALTER TABLE cpbindings
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1',
ADD FOREIGN KEY (CPName,ClusterId) REFERENCES callingplans (Name,ClusterId) ON DELETE CASCADE,
ADD FOREIGN KEY (CRName,ClusterId) REFERENCES callingroutes (Name,ClusterId) ON DELETE CASCADE,
DROP INDEX Name,
ADD UNIQUE KEY `Name` (`CPName`,`CRName`,`ClusterId`);


DROP TABLE IF EXISTS `deletedcallplans`;
CREATE TABLE  `deletedcallplans` (
  `EndpointId` bigint(20) NOT NULL,
  `PartitionId` tinyint(2) NOT NULL default '-1',
  `callingplanname` varchar(59) NOT NULL,
  PRIMARY KEY  (`EndpointId`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;


DROP TABLE IF EXISTS `eDNISroutenames`;
CREATE TABLE  `eDNISroutenames` (
  `Region` varchar(32) NOT NULL default '',
  `CallRouteNames` blob,
  `status` tinyint(2) NOT NULL default '0',
  PRIMARY KEY  (`Region`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

ALTER TABLE endpoints
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
CHANGE COLUMN `Flag` `Flag` tinyint(2) NOT NULL default '0',
CHANGE COLUMN `SipUri` `SipUri` varchar(255) default ' ',
CHANGE COLUMN `SipContact` `SipContact` varchar(255) default ' ',
CHANGE COLUMN `PeerGkId` `PeerGkId` varchar(255) default ' ',
CHANGE COLUMN `H235Password` `H235Password` varchar(63) character set latin1 collate latin1_bin NOT NULL default '',
CHANGE COLUMN `CdcPrflName` `CdcPrflName` varchar(31) default NULL,
DROP INDEX Ep_Sno_Port,
ADD UNIQUE KEY `Ep_Sno_Port` (`SerialNumber`,`Port`,`ClusterId`);

ALTER TABLE events
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE filters
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE groups
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1',
CHANGE COLUMN `EnforceVPort` `EnforceVPort` tinyint(2) NOT NULL default '0';


DROP TABLE IF EXISTS `iDNISroutenames`;
CREATE TABLE  `iDNISroutenames` (
  `stripaddback` varchar(48) NOT NULL default '',
  `CallRouteNames` varchar(59) NOT NULL,
  `status` tinyint(2) NOT NULL default '0',
  PRIMARY KEY  (`stripaddback`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

ALTER TABLE iedgegroups
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP COLUMN XFactor,
DROP INDEX IEdgeGroupName,
ADD UNIQUE KEY `IEdgeGroupName` (`Name`,`ClusterId`);


ALTER TABLE msws
CHANGE COLUMN  `AutosyncMaster` `AutosyncMaster` tinyint(2) NOT NULL default '-1';

ALTER TABLE periods
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE realms
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
ADD COLUMN `FwdSrcIP` smallint(6) default NULL,
DROP INDEX RealmName,
ADD UNIQUE KEY `RealmName` (`Name`,`ClusterId`);


ALTER TABLE regions
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

DROP TABLE IF EXISTS `routes`;

DROP TABLE IF EXISTS routesnames;

DROP TABLE IF EXISTS `plans`;



ALTER TABLE services
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE sessions
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE subnets
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP INDEX SubnetName,
ADD UNIQUE KEY `SubnetName` (`Name`,`ClusterId`);

ALTER TABLE trails
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE triggers
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP INDEX ClusterId_name,
ADD UNIQUE KEY `ClusterId_name` (`Name`,`ClusterId`);

ALTER TABLE users
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '-1';

ALTER TABLE vnet
CHANGE COLUMN `PartitionId` `PartitionId` tinyint(2) NOT NULL default '1',
DROP INDEX ClusterId_name,
ADD UNIQUE KEY `ClusterId_name` (`Name`,`ClusterId`);

DROP TABLE IF EXISTS 1carriers_buy;
CREATE TABLE 1carriers_buy LIKE carriers;

DROP TABLE IF EXISTS 1carriers_sell;
CREATE TABLE 1carriers_sell LIKE carriers;

DROP TABLE IF EXISTS 1carriers_buy_old;
CREATE TABLE 1carriers_buy_old LIKE carriers;

DROP TABLE IF EXISTS 1carriers_sell_old;
CREATE TABLE 1carriers_sell_old LIKE carriers;

DROP TABLE IF EXISTS 1ANIroutenames;
CREATE TABLE 1ANIroutenames LIKE ANIroutenames;

DROP TABLE IF EXISTS 1iDNISroutenames;
CREATE TABLE 1iDNISroutenames LIKE iDNISroutenames;

DROP TABLE IF EXISTS 1eDNISroutenames;
CREATE TABLE 1eDNISroutenames LIKE eDNISroutenames;

#VERSION 4.2d6

#VERSION 4.2d7

DROP TABLE IF EXISTS `systemalarms`;
CREATE TABLE  `systemalarms` (
  `AlarmId` bigint(20) NOT NULL auto_increment,
  `ActionId` varchar(64) NOT NULL default '',
  `Status` tinyint(2) NOT NULL default '0',
  `Type` varchar(32) NOT NULL default '',
  `Event` blob NOT NULL,
  `Created` datetime NOT NULL default '0000-01-01 00:00:00',
  `LastModified` datetime NOT NULL default '0000-01-01 00:00:00',
  PRIMARY KEY  (`AlarmId`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

#VERSION 4.2d7

#VERSION 4.2d8

#VERSION 4.2d8

#VERSION 4.2d9

DROP TABLE IF EXISTS `1eDNISroutenames`;

DROP TABLE IF EXISTS 1iDNISroutenames;
CREATE TABLE 1iDNISroutenames LIKE iDNISroutenames;

ALTER TABLE callingroutes
CHANGE COLUMN `CPName` `CPName` varchar(59) NOT NULL default '',
CHANGE COLUMN `TRName` `TRName` varchar(27) NOT NULL default '';

ALTER TABLE cdcprofiles
CHANGE COLUMN   Preferrred `Preferred` blob NOT NULL;

#VERSION 4.2d9

#VERSION 4.2d10

ALTER TABLE accesslist
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE actions
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE alarms
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE ANI
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

ALTER TABLE ANIroutenames
DROP COLUMN BuySell,
ADD COLUMN bs char(1) NOT NULL default '';

ALTER TABLE buysummary
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE callingplans
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE callingroutes
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE carriers
ADD COLUMN `BuySell` tinyint(2) NOT NULL default '0',
DROP COLUMN  `Priority`,
DROP COLUMN `ANI`,
DROP COLUMN `StripPrefix`,
DROP COLUMN `PrefixDigits`,
DROP COLUMN `AddbackDigits`,
DROP COLUMN `RatingAddback`,
DROP COLUMN `EndpointId`,
DROP COLUMN `flag`,
DROP COLUMN `DurMin`,
DROP COLUMN `DurIncr`,
DROP COLUMN `Rate`,
DROP COLUMN `Country`,
DROP COLUMN `ConnectionCharge`,
DROP COLUMN `EffectiveStartDate`,
DROP COLUMN `EffectiveEndDate`,
DROP COLUMN `Period`,
DROP COLUMN `status`,
DROP COLUMN `Created`,
DROP COLUMN `LastModified`,
DROP INDEX `ep_para`,
DROP INDEX `carrier_key`,
DROP INDEX `CarrierRegion`,
DROP INDEX `Region`,
DROP INDEX `ANI`,
DROP INDEX `Endpoint`,
ADD KEY `Carrier` (`Carrier`,`RegionCode`,`ServiceType`);


ALTER TABLE cdcprofiles
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE ivms-cdr-table
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE cdrfiles
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE cdrsummary
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE cpbindings
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE dbdiff
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

ALTER TABLE deletedcallplans
DROP PRIMARY KEY,
DROP COLUMN EndpointId,
ADD COLUMN `Id` bigint(20) NOT NULL,
ADD PRIMARY KEY (Id);

ALTER TABLE endpoints
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE events
CHANGE COLUMN `DateTime` `DateTime` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE groups
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE iedgegroups
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00',
ADD COLUMN `Version` int(11) NOT NULL default '0';


ALTER TABLE license
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE msws
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE periods
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE PipeLine
CHANGE COLUMN `ModifiedTime` `ModifiedTime` datetime NOT NULL default '1970-01-01 00:00:00';

DROP TABLE IF EXISTS `rates`;
CREATE TABLE  `rates` (
  `RateId` bigint(20) NOT NULL auto_increment,
  `CarrierId` bigint(20) NOT NULL,
  `Carrier` varchar(32) NOT NULL default '',
  `RegionCode` varchar(32) NOT NULL default '',
  `ServiceType` varchar(8) NOT NULL default '',
  `BuySell` tinyint(2) NOT NULL default '0',
  `Priority` int(11) NOT NULL default '0',
  `DurMin` mediumint(9) NOT NULL default '0',
  `DurIncr` mediumint(9) NOT NULL default '0',
  `Rate` float(10,4) NOT NULL default '0.0000',
  `Country` varchar(64) NOT NULL default '',
  `ConnectionCharge` float(10,4) NOT NULL default '0.0000',
  `EffectiveStartDate` datetime NOT NULL default '1970-01-01 00:00:00',
  `EffectiveEndDate` datetime NOT NULL default '1970-01-01 00:00:00',
  `Period` varchar(32) NOT NULL default '',
  `status` tinyint(2) NOT NULL default '0',
  `Created` datetime NOT NULL default '1970-01-01 00:00:00',
  `LastModified` datetime NOT NULL default '1970-01-01 00:00:00',
  PRIMARY KEY  (`RateId`),
  UNIQUE KEY `rate` (`CarrierId`,`EffectiveStartDate`,`EffectiveEndDate`,`Period`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;




ALTER TABLE realms
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE regions
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

DROP TABLE IF EXISTS `routes`;
CREATE TABLE  `routes` (
  `RouteId` bigint(20) NOT NULL auto_increment,
  `CarrierId` bigint(20) NOT NULL,
  `Carrier` varchar(32) NOT NULL default '',
  `RegionCode` varchar(32) NOT NULL default '',
  `ServiceType` varchar(8) NOT NULL default '',
  `BuySell` tinyint(2) NOT NULL default '0',
  `ANI` varchar(32) NOT NULL default '',
  `StripPrefix` varchar(32) NOT NULL default '',
  `PrefixDigits` mediumint(9) NOT NULL default '0',
  `AddbackDigits` varchar(16) NOT NULL default '',
  `RatingAddback` varchar(16) NOT NULL default '',
  `EndpointId` bigint(20) NOT NULL default '-1',
  `flag` tinyint(2) NOT NULL default '0',
  `status` tinyint(2) NOT NULL default '0',
  `Created` datetime NOT NULL default '1970-01-01 00:00:00',
  `LastModified` datetime NOT NULL default '1970-01-01 00:00:00',
  PRIMARY KEY  (`RouteId`),
  UNIQUE KEY `route` (`CarrierId`,`EndpointId`),
  KEY `ANI` (`ANI`),
  KEY `Endpoint` (`EndpointId`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


ALTER TABLE sellsummary
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE services
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE subnets
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';


ALTER TABLE systemalarms
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

ALTER TABLE trails
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00';

ALTER TABLE triggers
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

ALTER TABLE users
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

ALTER TABLE vnet
CHANGE COLUMN `Created` `Created` datetime NOT NULL default '1970-01-01 00:00:00',
CHANGE COLUMN `LastModified` `LastModified` datetime NOT NULL default '1970-01-01 00:00:00';

#VERSION 4.2d10


#VERSION 4.2d11

ALTER TABLE msws
DROP COLUMN ReadPassword,
DROP COLUMN WritePassword;

REPLACE INTO endpoints (Id, PartitionId, realmname, serialNumber, port, created, lastmodified) VALUES (-1,1,'','*',-1,now(),now());

-- Insert and delete an endpoint to get around the -1 endpointid problem
-- in mysql
INSERT INTO endpoints (serialnumber, port, PartitionId, clusterid, flag) VALUES ('ep1', 0, 1, 4, 1);
DELETE FROM endpoints where serialnumber='ep1' and port=0;

#VERSION 4.2d11

#VERSION 4.2d12
REPLACE INTO `MappingType` VALUES (1,"/opt/nextone/ivms/CDRStream/transform/example-mapping.xml",'example-mapping');

REPLACE INTO `MappingType` VALUES (2,"/opt/nextone/ivms/CDRStream/transform/export-mapping.xml",'export-mapping');

#VERSION 4.2d12
#VERSION 4.2d13
#VERSION 4.2d13

#VERSION 4.2dc1-4
use bn;

ALTER TABLE actions DROP KEY Name;
ALTER TABLE actions ADD UNIQUE KEY Name (Name,PartitionId);

delete from errors;

## CDR Error Codes
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(0,'abandoned',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(1,'user-blocked',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(2,'no-route',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(3,'busy',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(4,'resource-unavailable',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(5,'invalid-phone',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(6,'network-error',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(7,'no-ports',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(8,'general-error',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(9,'dest-unreach',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(10,'undefined',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(11,'no-bandwidth',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(12,'no-media-bandwidth',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(13,'h245-error',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(14,'incomp-addr',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(15,'local-disconnect',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(16,'h323-internal',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(17,'h323-proto',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(18,'no-call-handle',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(19,'gw-resource-unavailable',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(20,'fce-error-setup',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(21,'fce-error',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(22,'fce-no-vports',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(23,'no-vports',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(24,'shutdown',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(25,'hairpin',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(26,'switchover',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(27,'disconnect-unreachable',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(28,'dest-relcomp',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(29,'temporarily-unavailable',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(30,'msw-invalid-epi',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(31,'msw-routecalltogk',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(32,'msw-caller-not-registered',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(33,'401 authorization required ',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(34,'403 forbidden ',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(35,'407 proxy authorization required ',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(36,'500 internal error ',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(37,'501 not implemented ',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(38,'503 service unavailable ',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(39,'calling-entity-dyn-blacklisted',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(40,'called-entity-dyn-blacklisted',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(41,'Media CAC channels exceeded',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(42,'Media CAC bandwidth exceeded',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(43,'Media 911 CAC channels exceeded',now(),now());
REPLACE INTO errors (ErrorId,ErrDesc,Created,LastModified ) VALUES(44,'Media 911 CAC bandwidth exceeded',now(),now());

#VERSION 4.2dc1-4

#VERSION 4.2c1-10 merge from 4.0 (ticket# 30865)
DROP TABLE IF EXISTS cdrsummary;
CREATE TABLE cdrsummary (
  CdrSummaryId bigint(20) NOT NULL auto_increment,
  MSWId smallint(6) NOT NULL default '0',
  CDRFileId int(11) unsigned NOT NULL default '0',
  DateTimeInt int(11) NOT NULL default '0',
  OrigIp int(11) unsigned NOT NULL default '0',
  OrigGw varchar(64) NOT NULL default '',
  OrigPort smallint(6) NOT NULL default '0',
  TermIp int(11) unsigned NOT NULL default '0',
  TermGw varchar(64) NOT NULL default '',
  TermPort smallint(6) NOT NULL default '0',
  DiscCode char(2) NOT NULL default '',
  RegionCode varchar(32) default NULL,
  ErrorIdLeg1 mediumint(9) default NULL,
  ISDNCode mediumint(9) NOT NULL default '0',
  CallCount int(11) NOT NULL default '0',
  Duration bigint(11) NOT NULL default '0',
  PDD int(11) NOT NULL default '0',
  BuyCarrier varchar(32) NOT NULL default '',
  SellCarrier varchar(32) NOT NULL default '',
  MaxDateTimeInt int(11) NOT NULL default '0',
  MinDateTimeInt int(11) NOT NULL default '0',
  UserAuth set('1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64') default NULL,
  SrcPacketsReceived int(11) NOT NULL default '0',
  SrcPacketsLost int(11) NOT NULL default '0',
  SrcPacketsDiscarded int(11) NOT NULL default '0',
  SrcPDV int(11) NOT NULL default '0',
  SrcRFactor smallint(6) NOT NULL default '0',
  DstPacketsReceived int (11) NOT NULL default '0',
  DstPacketsLost int(11) NOT NULL default '0',
  DstPacketsDiscarded int(11) NOT NULL default '0',
  DstPDV int(11) NOT NULL default '0',
  DstRFactor smallint(6) NOT NULL default '0',
  Created datetime NOT NULL default '1970-01-01 00:00:00',
  LastModified datetime NOT NULL default '1970-01-01 00:00:00',
  PRIMARY KEY  (CdrSummaryId),
  KEY DateTimeInt (DateTimeInt),
  KEY CDRFileId (CDRFileId)
) TYPE=InnoDB PACK_KEYS=DEFAULT;

#VERSION 4.2c1-10


#VERSION 4.3t4
alter table users add PwdChangeTime bigint default 0;
#VERSION 4.3t4